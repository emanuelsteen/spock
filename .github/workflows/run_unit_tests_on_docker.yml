name: Build PostgreSQL from Source with Version-Specific Patches

on:
  schedule:
    - cron: '0 12,0 * * *'
  push:
    branches:
      gh_actions  
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        pg_version: ["15.10", "16.6", "17.2"] 

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          ref: ${{ github.ref }}

      - name: Build PostgreSQL ${{ matrix.pg_version }}
        run: docker build --build-arg PG_VERSION=${{ matrix.pg_version }} -t custom-postgres:${{ matrix.pg_version }} .

      - name: Run PostgreSQL Version Check for ${{ matrix.pg_version }}
        run: docker run --rm custom-postgres:${{ matrix.pg_version }} postgres --version

      - name: Verify Database is Live
        run: |
          psql -h localhost -U postgres -d postgres -c 'SELECT 1;'

      
